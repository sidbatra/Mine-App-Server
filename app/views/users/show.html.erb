<!-- Generate presenters to render this page -->
<%@user_presenter = presenter_for(@user)%>


<!-- Inject facebook og tags into the head -->
<%content_for :head do%>
  <!--TODO-->
  <%=render :partial  => 'facebook/og',
            :locals   => {
              :title        => @user_presenter.closet_name,
              :type         => 'link',
              :description  => @user_presenter.usage_description,
              :url          => @user_presenter.closet_url('fb'),
              :image        => ''}%>
<%end%>


<!-- Welcome box to signup if user is not logged in -->
<%=render :partial => 'misc/welcome', 
          :locals => {
            :user_presenter => @user_presenter,
            :source         => @user_presenter.source_id} unless logged_in?%>




<div id='profile_container'>

  
  <!-- Right column -->
	<div id='profile_right'>
	 	
    <!-- Following images and header -->
	 	<div id='follower_box'>

	 		<div id='following_msg' class='profile_right_title'>
        <%=@user_presenter.following_message%>
      </div>  
      	
      <div>
        <div id='ifollowers'>
          <%=blocker%>
        </div>
        <%=blocker%>
        

        <%if is_current_user(@user)%>
          <%=render 'invite'%>
          
          <div class='profile_right_title'>
            <%=image_tag 'star_12_666666.png'%> Star Users
          </div> 
          
          <%=render @examples%>
        <%end%>
        
      </div>
      			
      
      
      

		  <%=blocker%>
    </div> 
	
	 	<div id='closet_stats'>
      <%=@user_presenter.closet_stats%>
	 	</div>
	 	
	 	<div id='cat_nav'>
	 	
	 		<div id='cat_add'><br/>
        <%=@user_presenter.closet_create_links_near_filters(@categories)%>
	 		</div>

      <%=@user_presenter.closet_filter_links(@categories)%>
	 	</div>
	 	
	</div>



  <!-- Left column -->
	<div id='profile_main'>


		<div id='profile_details'>
      
      <%=@user_presenter.large_picture('profile_user_photo','picture')%>
		
			<div id='profile_details_right'>
			
		    <div id='profile_username'>
		      <%=@user_presenter.closet_title%>
		      
		      <!-- like button for the page -->
				  <%=render :partial => 'facebook/like', 
				            :locals => {
				            	:style				=> 'display:inline; margin-left: 5px; position:relative; top:-4px;',
                      :url          => @user_presenter.closet_url('fb'),
				              :send_button  => true,
				              :width        => 145,
				              :faces        => false}%>
		    </div>
		
		    <div id='profile_bio'>
		      <div id='user_byline_default'>	
            <%=render :partial  => 'byline',
                      :locals   => {:user => @user}%>
		      </div>
		    </div> 
		      
		  </div> <!--profile_details_right-->

		</div> <!--profile_details-->
			

		
    <%if is_current_user(@user)%>
      <div id='suggestions' class='slim_shadow_light'>
        <%=@user_presenter.closet_create_links(@categories)%>
      </div>
    <%end%>
  

    <div id='closet'>
      <div id='closet_top'>
      </div>
      
      <div id='closet_rows'>
        <div id='products'>
          <ul id='products_box'>	
            <%if @user.products_count > 0%>
	          <%elsif is_current_user(@user)%>
              <%=image_tag 'onboarding.jpg'%>
            <%else%>
              <%=image_tag 'onboarding_empty.jpg'%>
	          <%end%>
          </ul>
        </div>
      </div> 
      
      <div id='closet_bottom'>
      </div>
    </div>
    <!-- end of closet -->

	</div> <!-- profile_main -->


</div> <!-- profile_container -->



<%content_for :javascript do%>
  <%=render :partial => "misc/feedback"%>

  <script type="text/javascript">

    analytics.userLandsOn('<%=@user_presenter.source_id%>');

    new Denwen.FacebookView();
    new Denwen.Partials.UserProducts({
          el:$('#products_box'),
          user_id:<%=@user.id%>});

    var ifollowers  = new Denwen.Partials.IFollowers({
                                            id:<%=@user.id%>});
    
    <%if is_current_user(@user)%>
      var user          = new Denwen.Models.User(<%=@user.to_json%>);
      var bylineView    = new Denwen.UserBylineView({
                                model: user, 
                                el:$('#profile_bio')});

      var fbInvite      = new Denwen.FacebookInviteView({
                              id:'#action_link'});

      <%if @user.ifollowers.empty? && @source == "login"%>
        ifollowers.getAfterTimeout();
      <%end%>
                              
      analytics.identifyUser(
        "<%=self.current_user.email%>",
        "<%=user_full_name(self.current_user)%>",
        <%=self.current_user.age%>)
    <%end%>

    <%if @source == "product_create"%>
      analytics.productCreated();
    <%elsif @source == "login"%>
      analytics.userLogin();
    <%elsif @source == "product_deleted"%>
      analytics.productDeleted();
    <%end%>

    analytics.userProfileView(
      '<%=@source%>',
      '<%=@category ? @category.name : ""%>',
      <%=@user.id%>);

      //var w = Backbone.Router.extend({
      //  initialize :function() {
      //    console.log('INIT');
      //  },
      //  routes: {
      //    ":query" : "search"
      //  },
      //  search: function(query) {
      //    console.log('query - ' + query);
      //  }
      //});
      //new w();
      //Backbone.history.start();
  </script>
<%end%>

