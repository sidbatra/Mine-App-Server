<div class="container">


	<div class="thumbnail-box">
    <%if self.current_user.followings_count.zero?%>
      <p>
        <%=link_to "Invite a few friends", new_invite_path(:src => "placeholder")%>
        to start sharing purchases:
      </p>

      <%cache ["v1",self.current_user,"contacts","feed"] do%>
        <%self.current_user.contacts.by_weight.limit(10).each do |contact|%>
          <%cache ["v5",contact,"invite","feed"] do%>
            <%=link_to "",
                new_invite_path(:src => "user-image"),
                :style => "background: url('#{contact.image_url}')",
                :class => "thumb"%>
          <%end%>
        <%end%>
      <%end%>

    <%else%>
      <p>
        You're sharing purchases with:
      </p>

      <%cache ["v1",self.current_user,"ifollowers","feed"] do%>
        <%self.current_user.ifollowers.limit(10).each do |user|%>
          <%cache ["v5",user,"ifollower","feed"] do%>
            <%=link_to "",
                user_path(user.handle,:src => "feed"),
                :style => "background: url('#{user.square_image_url}')",
                :class => "thumb"%>
          <%end%>
        <%end%>
      <%end%>

    <%end%> <!-- if followings_count.zero? -->

    <%=link_to "Invite friends <i class='icon-chevron-right icon-white'></i>",
        new_invite_path(:src => "feed"),
        :class => "btn"%>
	</div> <!-- /thumbnail-box -->

  
  <%=render 'purchases/chooser'%>
  	

  <div class="col-triple">
  
    <div id="creation" class="item creation">
      <%form_for Purchase.new,
          :html => {
            :class => "form-horizontal",
            :style => "margin-bottom: 0;"} do |f|%>
    
          <%=render :partial => 'purchases/input', 
              :locals => {
                :f => f,
                :suggestion => nil,
                :submit_text => "Add to Mine",
                :submit_class => "new",
                :show_cancel_button => false,
                :show_delete_button => false,
                :show_query_box => true,
                :show_extra_steps => false,
                :show_fb_share => true,
                :fb_share_on => self.current_user.setting.post_to_timeline?}%>
      <%end%> <!-- /form --> 
    
    </div> <!-- /creation -->
    


    <div id="feed" class="feed">

      <%if self.current_user.purchases_count.zero?%>
        <%=render :partial => "feed/placeholder",
            :locals => {:user => self.current_user}%> 
      <%end%>

    </div> <!-- feed -->
    
    <div id="feed-spinner" 
          class="loading blocks body" 
          style="height: 60px;">
    </div> 
    

  </div> <!-- col-triple-->
      
<!--
  <div class="col">
    Two ways to add an item:<br />
    By detailed name: 'Bodum Chambord 32 Ounce French Press'
    By URL 'http://
  </div>
-->

</div> <!-- container -->

<%content_for :javascript do%>

  <script type="text/javascript">
    new Denwen.Views.Feed.Show({
      source          : "<%=@source%>",
      currentUserJSON : <%=self.current_user.to_json(:only => :fb_user_id)%>});
  </script>
<%end%>
