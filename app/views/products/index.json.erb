<%-cache @key do-%>
  <%-if @filter == :user || @filter == :liked || @filter == :wanted-%>
    <%=@products.to_json(
        :only     => [:id,:title,:is_gift,:handle,:price,
                      :comments_count,:user_id,:category_id],
        :methods  => [:giant_url],
        :include  => {
          :store  => {
            :only     => [:id,:name,:handle],
            :methods  => [:is_top]},
          :user => {
            :only => [:id,:first_name,:last_name,:handle]}})-%>
  <%-elsif @filter  == :store-%>
    <%=@products.to_json(
        :only     => [:id,:title,:is_gift,:handle,:price,
                      :comments_count,:user_id,:category_id],
        :methods  => [:giant_url],
        :include  => {
          :user => {
            :only => [:id,:first_name,:last_name,:handle],
            :methods  => [:photo_url]}})-%>
  <%-elsif @filter == :top-%>
    <%=@products.to_json(
        :only     => [:id,:title,:is_gift,:handle,:price,
                      :comments_count,:user_id,:category_id],
        :methods  => [:giant_url],
        :include  => {
          :user => {
            :only => [:id,:first_name,:last_name,:handle]}})-%>
  <%-end-%>
<%-end-%>
